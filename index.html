<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Web Concurrency 6.0 ¬∑ Manual Deck</title><style>:root{--lion:#ae9461;--night:#0d0d0d;--black:#030303;--garnet:#642b2b;--white:#ffffff;--bg:var(--night);--sidebar:#0b0b0b;--border:#222;--text:var(--white);--muted:#b9b9b9;--hover:#181818;--code:#101010;--callout:rgba(174,148,97,0.10);--focus:rgba(174,148,97,0.25);--shadow:0 10px 30px rgba(0,0,0,0.45);--radius:14px;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--serif:ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;--sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";--max:1220px}*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:var(--sans)}a{color:inherit}::selection{background:var(--focus)}.app{display:flex;min-height:100vh}.side{width:300px;background:linear-gradient(180deg,var(--black),var(--sidebar));border-right:1px solid var(--border);position:fixed;left:0;top:0;height:100vh;overflow:auto;z-index:50}.brand{padding:18px 16px;border-bottom:1px solid var(--border)}.brand .t{font-weight:900;letter-spacing:1.5px;color:var(--lion);font-size:15px;text-transform:uppercase}.brand .s{margin-top:6px;color:var(--muted);font-size:12px;letter-spacing:.8px}.nav{padding:10px 10px 18px}.nav a{display:flex;gap:10px;align-items:center;padding:10px 10px;border-radius:10px;text-decoration:none;color:var(--text);border:1px solid transparent;font-size:13px;font-weight:700}.nav a:hover{background:var(--hover);border-color:var(--border)}.nav a.active{background:var(--callout);border-color:rgba(174,148,97,0.35)}.nav .group{margin:14px 6px 8px;color:var(--muted);font-size:11px;font-weight:900;letter-spacing:1.2px;text-transform:uppercase}.main{flex:1;margin-left:300px;min-height:100vh}.topbar{position:sticky;top:0;z-index:40;background:rgba(13,13,13,0.86);backdrop-filter:blur(14px);border-bottom:1px solid var(--border)}.topbar .row{display:flex;align-items:center;gap:10px;padding:10px 12px}.btn{background:var(--hover);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px;font-family:var(--mono);font-size:12px;font-weight:800;cursor:pointer;display:inline-flex;align-items:center;gap:8px}.btn:hover{border-color:rgba(174,148,97,0.45)}.btn.primary{background:rgba(174,148,97,0.12);border-color:rgba(174,148,97,0.35)}.btn.danger{background:rgba(100,43,43,0.25);border-color:rgba(100,43,43,0.65)}.spacer{flex:1}.search{flex:1;max-width:520px;display:flex;gap:10px;align-items:center}.search input{width:100%;background:var(--code);border:1px solid var(--border);color:var(--text);padding:9px 12px;border-radius:12px;font-family:var(--mono);font-size:12px;outline:none}.search input:focus{border-color:rgba(174,148,97,0.55);box-shadow:0 0 0 3px rgba(174,148,97,0.10)}.wrap{max-width:var(--max);margin:0 auto;padding:18px 16px 40px}.card{background:rgba(0,0,0,0.22);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}.hero{padding:18px 18px 16px}.kicker{display:flex;gap:10px;align-items:center;color:var(--muted);font-family:var(--mono);font-weight:800;font-size:12px;letter-spacing:0.8px}.badge{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(174,148,97,0.35);background:rgba(174,148,97,0.10);color:var(--lion);padding:6px 10px;border-radius:999px;font-family:var(--mono);font-size:11px;font-weight:900}.title{margin:10px 0 6px;font-size:28px;line-height:1.1;font-weight:1000;letter-spacing:-0.6px}.subtitle{margin:0;color:var(--muted);font-size:14px;line-height:1.5}.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:12px;margin-top:14px}.panel{padding:14px;border-radius:var(--radius);border:1px solid var(--border);background:rgba(0,0,0,0.26)}.panel h3{margin:0 0 8px;font-size:13px;font-weight:950;letter-spacing:0.8px;text-transform:uppercase;color:var(--lion)}.panel p{margin:0 0 8px;color:var(--muted);font-size:13px;line-height:1.6}.panel ul{margin:0;padding-left:16px;color:var(--muted);font-size:13px;line-height:1.6}.hr{height:1px;background:var(--border);margin:14px 0}.tocmini{display:flex;flex-wrap:wrap;gap:8px}.chip{border:1px solid var(--border);background:var(--hover);padding:7px 10px;border-radius:999px;font-family:var(--mono);font-size:11px;font-weight:900;text-decoration:none;color:var(--text)}.chip:hover{border-color:rgba(174,148,97,0.45)}section{margin-top:14px}.sec{padding:16px}.sec h2{margin:0 0 10px;font-size:18px;font-weight:1000;letter-spacing:-0.2px;color:var(--white)}.sec h2 .n{color:var(--lion);font-family:var(--mono);font-size:14px;font-weight:1000;margin-right:8px}.sec h3{margin:14px 0 8px;font-size:13px;color:var(--lion);text-transform:uppercase;letter-spacing:0.8px}.sec p{margin:0 0 10px;color:var(--muted);font-size:13.5px;line-height:1.7}.sec .callout{border:1px solid rgba(174,148,97,0.35);background:rgba(174,148,97,0.07);padding:12px;border-radius:12px}.cols{column-count:2;column-gap:24px}.cols p,.cols ul,.cols ol{break-inside:avoid}.legal{font-family:var(--serif);color:#eaeaea}.legal p{font-family:var(--serif);font-size:14px;line-height:1.75;color:#e6e6e6;text-align:justify}.legal .lead::first-letter{float:left;font-size:56px;line-height:52px;padding-right:10px;color:var(--lion);font-weight:1000;font-family:var(--serif)}.table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid var(--border)}.table th,.table td{padding:10px 10px;border-bottom:1px solid var(--border);vertical-align:top;font-size:12.5px}.table th{background:rgba(0,0,0,0.35);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.9px;font-weight:950;color:var(--lion)}.table tr:last-child td{border-bottom:none}.mono{font-family:var(--mono)}.code{background:var(--code);border:1px solid var(--border);border-radius:12px;overflow:hidden}.code .bar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 10px;border-bottom:1px solid var(--border);background:rgba(0,0,0,0.28)}.code .bar .lab{font-family:var(--mono);font-weight:950;font-size:12px;color:var(--lion)}pre{margin:0;padding:12px 12px;overflow:auto;max-height:520px}code,pre{font-family:var(--mono);font-size:12px;line-height:1.6;color:#efefef}details{border:1px solid var(--border);border-radius:12px;background:rgba(0,0,0,0.22);overflow:hidden}summary{cursor:pointer;list-style:none;padding:12px 12px;font-family:var(--mono);font-weight:950;font-size:12.5px;color:var(--white);display:flex;gap:10px;align-items:center}summary::-webkit-details-marker{display:none}details[open] summary{border-bottom:1px solid var(--border);background:rgba(0,0,0,0.30)}.pill{display:inline-flex;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid rgba(174,148,97,0.35);background:rgba(174,148,97,0.10);color:var(--lion);font-size:11px;font-weight:950;margin-left:auto}.split{display:grid;grid-template-columns:1fr 1fr;gap:12px}.demo{display:grid;grid-template-columns:1fr 1fr;gap:12px}.demo textarea{width:100%;height:200px;background:var(--code);border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px;font-family:var(--mono);font-size:12px;outline:none;resize:vertical}.demo textarea:focus{border-color:rgba(174,148,97,0.55);box-shadow:0 0 0 3px rgba(174,148,97,0.10)}.frame{background:rgba(0,0,0,0.20);border:1px solid var(--border);border-radius:12px;padding:10px;min-height:200px}.frame .ft{font-family:var(--mono);font-size:11px;font-weight:950;color:var(--lion);margin-bottom:8px}.foot{margin-top:16px;color:var(--muted);font-family:var(--mono);font-size:11.5px;text-align:center}.hide{display:none}
/* Scrolodex (Rolodex-scroll) */.scrolodex{position:fixed;right:14px;top:78px;width:260px;z-index:45;border:1px solid rgba(174,148,97,0.35);background:rgba(0,0,0,0.60);backdrop-filter:blur(14px);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,0.55);overflow:hidden;transform:translateY(-6px);opacity:0;pointer-events:none;transition:opacity .14s ease,transform .14s ease}.scrolodex.on{opacity:1;transform:translateY(0)}.scrolodex .hd{display:flex;gap:10px;align-items:center;padding:10px 10px;border-bottom:1px solid rgba(255,255,255,0.06)}.scrolodex .hd .k{font-family:var(--mono);font-size:11px;font-weight:950;color:var(--lion);letter-spacing:0.8px;text-transform:uppercase}.scrolodex .hd .p{margin-left:auto;font-family:var(--mono);font-size:11px;font-weight:950;color:rgba(255,255,255,0.85)}.scrolodex .win{height:140px;position:relative;background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(0,0,0,0.10));overflow:hidden}.scrolodex .fadeTop,.scrolodex .fadeBot{position:absolute;left:0;right:0;height:36px;z-index:2;pointer-events:none}.scrolodex .fadeTop{top:0;background:linear-gradient(180deg,rgba(0,0,0,0.80),rgba(0,0,0,0))}.scrolodex .fadeBot{bottom:0;background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,0.80))}.scrolodex .track{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);transition:transform .18s cubic-bezier(.2,.8,.2,1)}.scrolodex .item{height:28px;display:flex;align-items:center;gap:10px;padding:0 10px;font-family:var(--mono);font-size:11px;font-weight:900;color:rgba(255,255,255,0.55);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-left:4px solid transparent}.scrolodex .item .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.20);flex:0 0 8px}.scrolodex .item.active{color:rgba(255,255,255,0.96);border-left-color:rgba(174,148,97,0.85);background:rgba(174,148,97,0.10)}.scrolodex .item.active .dot{background:rgba(174,148,97,0.85)}.scrolodex.pulse{animation:sdPulse .22s ease}@keyframes sdPulse{0%{transform:translateY(0) scale(1)}50%{transform:translateY(0) scale(1.015)}100%{transform:translateY(0) scale(1)}}
@media (max-width:1040px){.grid{grid-template-columns:1fr}.demo{grid-template-columns:1fr}.split{grid-template-columns:1fr}.cols{column-count:1}.side{width:280px}.main{margin-left:280px}.scrolodex{width:240px}}@media (max-width:820px){.side{position:fixed;transform:translateX(-100%);transition:transform .18s ease}.side.open{transform:translateX(0)}.main{margin-left:0}.search{display:none}.scrolodex{right:10px;top:68px;width:220px}}@media print{body{background:#fff;color:#000}.side,.topbar,.btn,.chip,.scrolodex{display:none !important}.main{margin-left:0}.wrap{max-width:none;padding:0}.card{box-shadow:none;border:none;border-radius:0;background:#fff}.panel,.callout,details,.code{border:1px solid #ddd;background:#fff}.table{border:1px solid #ddd}.table th{background:#f6f6f6;color:#000}.sec p,.legal p{color:#111}.title{color:#000}.subtitle{color:#333}.kicker,.badge{color:#000;border-color:#999;background:#f6f6f6}.cols{column-count:2}}</style></head><body><div class="app"><aside class="side" id="side"><div class="brand"><div class="t">Web Concurrency 6.0</div><div class="s">Normalized Web ¬∑ Manual Deck ¬∑ W3C-facing</div></div><nav class="nav" id="nav"><div class="group">Manual</div><a href="#cover" data-k="cover">Cover / Abstract</a><a href="#toc" data-k="toc">Deck Outline</a><div class="group">Standards Lens</div><a href="#jsr-lens" data-k="jsr-lens">JSR 166 / 176 / 177 Standards Lens</a><a href="#conformance" data-k="conformance">Conformance Model</a><div class="group">Architecture</div><a href="#overview" data-k="overview">WC6 Overview</a><a href="#etlpipeline" data-k="etlpipeline">ETL Pipeline</a><a href="#primitive-registry" data-k="primitive-registry">Primitives / Surrogates / Tokens</a><a href="#manifest" data-k="manifest">Manifest Format</a><a href="#crosswalk" data-k="crosswalk">Nomenclature Crosswalk</a><div class="group">Modules</div><a href="#pollen" data-k="pollen">Pollen.js (Extract)</a><a href="#nectar" data-k="nectar">Nectar.js / NeutroJS (Transform)</a><a href="#mead" data-k="mead">Mead.js (Load)</a><a href="#polymorphi" data-k="polymorphi">Polymorphi.css (Tokens)</a><div class="group">Concurrency</div><a href="#atomic-controller" data-k="atomic-controller">Atomic Controller</a><a href="#scheduling" data-k="scheduling">Tasks / Scheduling</a><a href="#memorymodel" data-k="memorymodel">Memory / Determinism</a><div class="group">Security</div><a href="#security" data-k="security">Security / Trust</a><a href="#integrity" data-k="integrity">Integrity / Provenance</a><div class="group">Appendices</div><a href="#mapping" data-k="mapping">Mapping to java.util.concurrent</a><a href="#ri" data-k="ri">Reference Implementation</a><a href="#glossary" data-k="glossary">Glossary</a><a href="#revision" data-k="revision">Revision / Notes</a></nav></aside><main class="main"><div class="topbar"><div class="row"><button class="btn" id="btnSide">‚ò∞ Panel</button><button class="btn" id="btnTop">‚Üë Top</button><button class="btn primary" id="btnPrint">üñ®Ô∏è Print / PDF</button><button class="btn" id="btnCopy">‚ßâ Copy Deck HTML</button><div class="spacer"></div><div class="search"><input id="q" type="text" placeholder="Search in deck (titles + body) ¬∑ filter sections live‚Ä¶"></div><button class="btn danger" id="btnCollapse">‚ñæ Collapse All</button></div></div><div class="scrolodex" id="sd"><div class="hd"><div class="k">Scrolodex</div><div class="p" id="sdPos">‚Äî</div></div><div class="win"><div class="fadeTop"></div><div class="fadeBot"></div><div class="track" id="sdTrack"></div></div></div><div class="wrap"><div class="card hero" id="cover"><div class="kicker"><span class="badge">WC6</span><span class="badge">Normalized Web</span><span class="badge">Concurrent Programming for Web 6.0</span></div><div class="title">Web Concurrency 6.0 ¬∑ Manual Deck</div><p class="subtitle">A deterministic, ID-indexed, concurrency-disciplined Web runtime: <span class="mono">Pollen.js ‚Üí Nectar.js/NeutroJS ‚Üí Mead.js</span> with <span class="mono">Polymorphi.css</span> tokenization; designed for W3C-facing technical review and independent convergence with <span class="mono">java.util.concurrent</span> patterns.</p><div class="grid"><div class="panel"><h3>Abstract</h3><p>WC6 defines a browser-native ETL architecture where websites are projections from normalized manifests. It formalizes: (a) extraction into blueprints and metadata, (b) atomic transform under ID discipline, and (c) deterministic DOM output‚Äîwithout external fetches.</p><p class="callout mono">Key invariant: every renderable unit MUST be addressable by stable ID; invalid IDs MUST be rejectable at the executive function boundary.</p></div><div class="panel"><h3>Stack Summary</h3><ul><li><b>Pollen.js</b> ‚Äî collection/normalization (extractor)</li><li><b>Nectar.js / NeutroJS</b> ‚Äî transform + atomic controller (executor)</li><li><b>Mead.js</b> ‚Äî deterministic DOM output (loader)</li><li><b>Polymorphi.css</b> ‚Äî token library (CSS var substrate)</li></ul><div class="hr"></div><div class="tocmini"><a class="chip" href="#overview">Architecture</a><a class="chip" href="#manifest">Manifest</a><a class="chip" href="#nectar">Nectar Spec</a><a class="chip" href="#atomic-controller">Atomic Controller</a><a class="chip" href="#ri">Reference Impl</a></div></div></div></div><div class="card sec" id="toc"><h2><span class="n">¬ß0</span>Deck Outline</h2><div class="cols"><p class="legal lead">This manual deck is structured to look and feel like a standards deliverable: identification, scope, definitions, normative rules, conformance, security considerations, and reference implementation. It is intentionally finite and auditable: every concept is tied to a primitive set, a manifest field, or an execution boundary.</p><h3>Primary Chapters</h3><ol class="legal"><li><b>Standards Lens</b> ‚Äî how WC6 borrows the ‚Äúdeliverable shape‚Äù of JSR documentation.</li><li><b>WC6 Overview</b> ‚Äî normalized web, determinism, zero external fetches.</li><li><b>ETL Pipeline</b> ‚Äî Pollen ‚Üí Nectar/Neutro ‚Üí Mead.</li><li><b>Primitives / Surrogates / Tokens</b> ‚Äî ID ranges and responsibilities.</li><li><b>Manifest Format</b> ‚Äî canonical schema and requirements.</li><li><b>Modules</b> ‚Äî Pollen.js, Nectar.js/NeutroJS, Mead.js, Polymorphi.css.</li><li><b>Concurrency</b> ‚Äî atomic controller, scheduling, memory model.</li><li><b>Security</b> ‚Äî trust boundaries, ID rejection, provenance.</li><li><b>Appendices</b> ‚Äî mapping to <span class="mono">java.util.concurrent</span> and RI.</li></ol></div></div><div class="card sec" id="jsr-lens"><h2><span class="n">¬ß1</span>JSR 166 / 176 / 177 Standards Lens</h2><p>This section is NOT an adoption of Java naming; it‚Äôs a reuse of what makes a spec credible: finite scope, normative language, deliverables, and an auditable outline. WC6 mirrors the ‚Äúmanual shape‚Äù so reviewers can quickly locate: requirements, optionality, security considerations, and compliance.</p><div class="split"><div class="callout"><h3>JSR 166 (Shape Borrowed)</h3><p class="mono">Identification ‚Üí Request ‚Üí Contributions ‚Üí Additional Information</p><p>WC6 uses the same ‚Äúfront matter‚Äù discipline to reduce ambiguity: explicit request, rationale, and artifact list (spec + RI + tests).</p></div><div class="callout"><h3>JSR 176 / 177 (Deliverables Borrowed)</h3><p>WC6 follows the JSR convention of separating:</p><ul><li><b>Specification</b> (normative rules)</li><li><b>Reference Implementation</b> (executable artifact)</li><li><b>Test Assertions</b> (conformance checks)</li><li><b>Security Considerations</b> (threat model + mitigations)</li></ul></div></div><h3>WC6 ‚ÄúRequest‚Äù (Executable Summary)</h3><table class="table"><thead><tr><th>Field</th><th>WC6 Value</th></tr></thead><tbody><tr><td class="mono">Title</td><td>Concurrent Programming for Web 6.0 (Web Concurrency 6.0)</td></tr><tr><td class="mono">Abstract</td><td>Deterministic projection of websites from normalized manifests under ID-discipline, using an atomic controller pattern.</td></tr><tr><td class="mono">Deliverables</td><td>Manual deck (this), reference implementation (embedded), conformance checks (embedded), sample manifests (embedded).</td></tr><tr><td class="mono">Non-Goals</td><td>Framework replacement, build step requirement, server-side render dependency.</td></tr><tr><td class="mono">Primary Substrate</td><td>Browser primitives: DOM, CSS variables, JS runtime; no external namespace fetches.</td></tr></tbody></table></div><div class="card sec" id="conformance"><h2><span class="n">¬ß2</span>Conformance Model</h2><p>Conformance is defined in three layers: <b>Manifest</b> (schema validity), <b>Execution</b> (atomic controller sequencing), and <b>Output</b> (deterministic render rules). A WC6 implementation MUST support the mandatory surface below; optional surfaces MAY be implemented.</p><details open><summary>Mandatory Surface (MUST) <span class="pill">Normative</span></summary><div class="sec"><ul><li><span class="mono">Pollen.extractDOM</span> MUST produce stable blueprint IDs for every renderable node.</li><li><span class="mono">Nectar.sovereign</span> MUST reject invalid IDs; MUST return a manifest that can be rendered without external fetch.</li><li><span class="mono">AtomicController.commit</span> MUST serialize mutations per policy domain (scope).</li><li><span class="mono">Mead.renderManifest</span> MUST reproduce blueprint structure deterministically with stable attribute ordering.</li><li><span class="mono">Polymorphi tokens</span> MUST resolve via CSS variables; missing tokens MUST degrade in a defined way (fallback chain).</li></ul></div></details><details><summary>Optional Surface (MAY) <span class="pill">Optional</span></summary><div class="sec"><ul><li>Snapshot persistence across sessions.</li><li>Cryptographic provenance seals for manifests.</li><li>Parallel extract pipelines with reconciliation (multi-source pollen).</li><li>Policy-domain scheduler integration (e.g., animation ticks vs interaction ticks).</li></ul></div></details></div><div class="card sec" id="overview"><h2><span class="n">¬ß3</span>WC6 Overview</h2><div class="cols legal"><p class="lead">WC6 treats the browser as the runtime and the manifest as the contract. A website becomes a deterministic function: <span class="mono">DOM = Mead(Nectar(Pollen(Input)))</span>. This is not rhetoric; it is the execution boundary. Every transformation MUST be auditable because every unit is ID-indexed.</p><p><b>Determinism</b> means identical manifest inputs yield identical DOM outputs under defined environmental constraints. <b>Concurrency</b> means multiple intents (render, interaction, state, IO) are scheduled without tearing invariants. WC6 uses an atomic controller to serialize mutations per policy scope.</p><p><b>Normalized Web</b> means the manifest format is stable and transportable: it can be stored, diffed, hashed, compared, and tested without running the site.</p></div><div class="hr"></div><h3>Design Goals</h3><ul><li>Websites as projections from manifests; no hidden state required to reproduce structure.</li><li>ID-discipline enforced at executive function boundary (reject invalid IDs early).</li><li>Token-first styling: values resolved through variable layers.</li><li>Atomic scheduling: serialize or reconcile concurrent mutation streams per scope.</li></ul></div><div class="card sec" id="etlpipeline"><h2><span class="n">¬ß4</span>ETL Pipeline</h2><table class="table"><thead><tr><th>Stage</th><th>Module</th><th>Input</th><th>Output</th><th>Normative Notes</th></tr></thead><tbody><tr><td class="mono">Extract</td><td><b>Pollen.js</b></td><td>DOM/HTML/CSS/events</td><td>Blueprints + metadata</td><td>MUST enumerate renderable units; MUST assign stable IDs.</td></tr><tr><td class="mono">Transform</td><td><b>Nectar.js / NeutroJS</b></td><td>Pollen outputs + policies</td><td>Manifest + tokens + tasks</td><td>MUST validate IDs; MUST schedule via AtomicController per scope.</td></tr><tr><td class="mono">Load</td><td><b>Mead.js</b></td><td>Manifest</td><td>Deterministic DOM</td><td>MUST render stable order; MUST bind events after structure is materialized.</td></tr></tbody></table><div class="hr"></div><div class="callout"><p class="mono"><b>Key Rule:</b> The transform stage is the ‚Äúlaw of the door.‚Äù If a unit has no valid ID, it cannot enter execution.</p></div></div><div class="card sec" id="primitive-registry"><h2><span class="n">¬ß5</span>Primitives / Surrogates / Tokens</h2><p>WC6 assigns numeric ranges to categorize executable artifacts. These ranges allow finite reasoning: ‚Äúwhat can exist‚Äù is bounded and addressable.</p><table class="table"><thead><tr><th>Range</th><th>Category</th><th>Description</th><th>Examples</th></tr></thead><tbody><tr><td class="mono">1‚Äì1099</td><td>ETL Primitives</td><td>Core pipeline IDs and contracts</td><td>Pollen, Nectar, Mead, Registry, AtomicController</td></tr><tr><td class="mono">1100‚Äì1999</td><td>ETL Surrogates</td><td>Composable ‚Äúsubatomic‚Äù units</td><td>Blueprint, Sequence, Task, Schedule, Snapshot</td></tr><tr><td class="mono">2000‚Äì2389</td><td>Polymorphi Tokens</td><td>CSS var-resolved token keys</td><td>--token-2001-* families, semantic layers</td></tr></tbody></table><h3>Normative Token Resolution</h3><p class="mono">ComputedStyle = resolve(var(--semantic) ‚Üí var(--subprimitive) ‚Üí var(--primitive) ‚Üí fallback literal)</p></div><div class="card sec" id="manifest"><h2><span class="n">¬ß6</span>Manifest Format</h2><p>The manifest is the canonical contract for deterministic output. It MUST be serializable, diffable, and renderable without external fetch. The minimal required fields are below; implementations MAY add extensions under <span class="mono">extensions</span>.</p><div class="code"><div class="bar"><div class="lab">wc6.manifest.json (canonical)</div><button class="btn" data-copy="#m1">‚ßâ Copy</button></div><pre><code id="m1">{\n  \"manifestId\": \"wc6-...\",\n  \"version\": \"6.0.0\",\n  \"policyDomain\": \"default\",\n  \"createdAt\": \"2025-12-19T00:00:00Z\",\n  \"blueprints\": [\n    {\"id\":\"node-1\",\"tag\":\"div\",\"attrs\":{\"class\":\"...\"},\"text\":\"\",\"children\":[\"node-2\"]}\n  ],\n  \"tokens\": {\n    \"--token-2001-primary\": \"#ae9461\",\n    \"--token-2002-bg\": \"#0d0d0d\"\n  },\n  \"events\": [\n    {\"targetId\":\"node-2\",\"type\":\"click\",\"action\":\"task:toggle\"}\n  ],\n  \"tasks\": [\n    {\"id\":\"task:toggle\",\"scope\":\"default\",\"run\":\"...\"}\n  ],\n  \"extensions\": {}\n}\n</code></pre></div><h3>Validation Rules (MUST)</h3><ul><li><b>ID Uniqueness:</b> every blueprint <span class="mono">id</span> MUST be unique; duplicates MUST fail validation.</li><li><b>Stable Children:</b> <span class="mono">children</span> MUST reference existing IDs; missing references MUST fail.</li><li><b>Token Keys:</b> token keys MUST be valid CSS custom property names.</li><li><b>Events:</b> event targets MUST resolve to a blueprint node or defined selector scope.</li></ul></div><div class="card sec" id="crosswalk"><h2><span class="n">¬ß7</span>Nomenclature Crosswalk</h2><p>WC6 replaces older internal labels with ‚Äúreal terms‚Äù that match standards language. This is a crosswalk‚Äîkeeping the conceptual bones while using credible naming.</p><table class="table"><thead><tr><th>Older Term</th><th>WC6 Term</th><th>Definition</th></tr></thead><tbody><tr><td class="mono">Sovereign</td><td><b>Executive Function Controller</b></td><td>Top boundary that accepts/rejects inputs and selects pipeline entry.</td></tr><tr><td class="mono">Scepter</td><td><b>Authority Token</b></td><td>Capability marker enabling privileged transforms within a policy domain.</td></tr><tr><td class="mono">Realm</td><td><b>Token Manager</b></td><td>Maps primitives to surrogates to tokens; maintains forward/reverse resolution.</td></tr><tr><td class="mono">Blueprint</td><td><b>Blueprint</b></td><td>Normalized structural unit for rendering and binding.</td></tr><tr><td class="mono">Sequence</td><td><b>Execution Sequence</b></td><td>Ordered set of tasks under atomic control.</td></tr><tr><td class="mono">Atomic Worker</td><td><b>Atomic Controller</b></td><td>Serializes concurrent mutation streams per scope.</td></tr></tbody></table></div><div class="card sec" id="pollen"><h2><span class="n">¬ß8</span>Pollen.js (Extract)</h2><p>Pollen is the extractor: it collects DOM structure, style metadata, and event intent metadata into normalized blueprints. It is deterministic: given the same input document, it MUST produce the same blueprint ordering and IDs under the same ID policy.</p><details open><summary>Pollen Spec Summary <span class="pill">MUST</span></summary><div class="sec"><table class="table"><thead><tr><th>API</th><th>Signature</th><th>Output</th><th>Notes</th></tr></thead><tbody><tr><td class="mono">extractDOM</td><td class="mono">(rootEl, opts?) ‚Üí {blueprints, rootId}</td><td>Blueprint array</td><td>MUST assign stable IDs; MUST include attrs + text.</td></tr><tr><td class="mono">extractStyles</td><td class="mono">(document) ‚Üí {stylesheets, inline}</td><td>Style metadata</td><td>Best-effort; cross-origin CSS may be blocked by browser.</td></tr><tr><td class="mono">extractEvents</td><td class="mono">(rootEl) ‚Üí EventIntent[]</td><td>Event intent list</td><td>Collects <span class="mono">data-wc6-on*</span> attributes as declarative event intents.</td></tr></tbody></table></div></details><details><summary>Pollen Reference (Readable) <span class="pill">RI</span></summary><div class="sec"><div class="code"><div class="bar"><div class="lab">Pollen.js (reference)</div><button class="btn" data-copy="#pol1">‚ßâ Copy</button></div><pre><code id="pol1">/* Pollen.js ‚Äî Extract: DOM ‚Üí Blueprints + Metadata */\nconst Pollen={\n  extractDOM:(rootEl,opts={})=>{const idKey=opts.idKey||\"data-wc6-id\";let c=0;const mkId=()=>\"node-\"+(++c);const blue=[];const walk=(el)=>{if(!el||el.nodeType!==1){return null;}const id=el.getAttribute(idKey)||mkId();el.setAttribute(idKey,id);const attrs={};Array.from(el.attributes||[]).forEach(a=>{if(a&&a.name){attrs[a.name]=a.value;}});const kids=[];Array.from(el.childNodes||[]).forEach(n=>{if(n.nodeType===1){const kid=walk(n);if(kid)kids.push(kid);} });const text=Array.from(el.childNodes||[]).filter(n=>n.nodeType===3).map(n=>n.nodeValue).join(\"\").trim();blue.push({id,tag:(el.tagName||\"\").toLowerCase(),attrs,text,children:kids});return id;};const rootId=walk(rootEl);return{rootId,blueprints:blue};},\n  extractStyles:(doc)=>{const stylesheets=[];const inline=[];(Array.from(doc.styleSheets||[])||[]).forEach(ss=>{const item={href:ss.href||\"\",rules:[]};try{const rules=Array.from(ss.cssRules||[]);rules.forEach(r=>item.rules.push(r.cssText));}catch(e){item.blocked=true;}stylesheets.push(item);});(Array.from(doc.querySelectorAll(\"style\")||[])||[]).forEach(s=>inline.push(s.textContent||\"\"));return{stylesheets,inline};},\n  extractEvents:(rootEl)=>{const intents=[];const all=[rootEl,...Array.from(rootEl.querySelectorAll(\"*\")||[])];all.forEach(el=>{Array.from(el.attributes||[]).forEach(a=>{if(!a||!a.name)return;const n=a.name.toLowerCase();if(n.startsWith(\"data-wc6-on\")){const type=n.replace(\"data-wc6-on\",\"\")||\"click\";const targetId=el.getAttribute(\"data-wc6-id\")||\"\";const action=a.value||\"\";intents.push({targetId,type,action});}});});return intents;}\n};</code></pre></div></div></details></div><div class="card sec" id="nectar"><h2><span class="n">¬ß9</span>Nectar.js / NeutroJS (Transform)</h2><p>Nectar is the executor/transformer. It accepts pollen outputs (or raw inputs) at the executive boundary, validates IDs, schedules transforms under atomic control, and emits a manifest suitable for deterministic rendering.</p><details open><summary>Nectar Core Objects <span class="pill">MUST</span></summary><div class="sec"><table class="table"><thead><tr><th>Object</th><th>Role</th><th>Normative Rules</th></tr></thead><tbody><tr><td class="mono">Registry</td><td>Namespace store</td><td>MUST isolate by namespace; MUST support deterministic retrieval.</td></tr><tr><td class="mono">AtomicController</td><td>Serializes mutations</td><td>MUST serialize by scope; MUST return Promises; MUST avoid deadlocks.</td></tr><tr><td class="mono">Executor</td><td>Runs tasks</td><td>MUST run via AtomicController; MUST produce stable output for stable input.</td></tr><tr><td class="mono">Task</td><td>Unit of work</td><td>MUST be addressable; SHOULD be pure or controlled side-effects only.</td></tr><tr><td class="mono">Schedule</td><td>Task ordering</td><td>MUST be explicit; SHOULD encode policy scope and priority.</td></tr></tbody></table></div></details><details><summary>Nectar Reference (Readable) <span class="pill">RI</span></summary><div class="sec"><div class="code"><div class="bar"><div class="lab">Nectar.js / NeutroJS (reference)</div><button class="btn" data-copy="#nec1">‚ßâ Copy</button></div><pre><code id="nec1">/* Nectar.js ‚Äî Transform: Pollen Output ‚Üí Manifest under Atomic Controller */\nconst Registry=(function(){const ns=new Map();const getNS=(name)=>{if(!ns.has(name))ns.set(name,new Map());return ns.get(name);};return{put:(name,key,val)=>{getNS(name).set(key,val);return val;},get:(name,key)=>getNS(name).get(key),has:(name,key)=>getNS(name).has(key),del:(name,key)=>getNS(name).delete(key),listNS:()=>Array.from(ns.keys()).sort(),listKeys:(name)=>Array.from(getNS(name).keys()).sort(),clearNS:(name)=>{ns.delete(name);}};})();\nconst AtomicController=(function(){const chains=new Map();const q=(scope)=>{if(!chains.has(scope))chains.set(scope,Promise.resolve());return chains.get(scope);};return{commit:(scope,fn)=>{const prev=q(scope);const next=prev.then(()=>Promise.resolve().then(fn));chains.set(scope,next.catch(()=>{}));return next;}};})();\nconst Nectar={\n  validateBlueprints:(blueprints)=>{const set=new Set();for(const b of blueprints){if(!b||typeof b.id!==\"string\"||!b.id.trim())throw new Error(\"WC6 ID invalid\");if(set.has(b.id))throw new Error(\"WC6 duplicate ID: \"+b.id);set.add(b.id);if(b.children){for(const cid of b.children){if(typeof cid!==\"string\")throw new Error(\"WC6 child ref invalid\");}}}return true;},\n  sovereign:(input,opts={})=>{const policyDomain=opts.policyDomain||\"default\";return AtomicController.commit(policyDomain,()=>{let pollen=input;if(input&&input.blueprints&&input.rootId){pollen=input;}else{throw new Error(\"WC6 sovereign requires pollen output in this RI\");}\n    Nectar.validateBlueprints(pollen.blueprints);\n    const manifest={manifestId:\"wc6-\"+Math.random().toString(16).slice(2),version:\"6.0.0\",policyDomain,createdAt:new Date().toISOString(),blueprints:pollen.blueprints,tokens:opts.tokens||{},events:opts.events||[],tasks:opts.tasks||[],extensions:opts.extensions||{}};\n    Registry.put(\"manifests\",manifest.manifestId,manifest);\n    return manifest;\n  });}\n};</code></pre></div></div></details></div><div class="card sec" id="mead"><h2><span class="n">¬ß10</span>Mead.js (Load)</h2><p>Mead is the loader: it materializes the manifest into deterministic DOM output. It binds declared events only after structure is in place. It applies tokens by writing CSS variables (no hard-coded values in the deck‚Äôs runtime path).</p><details open><summary>Mead Spec Summary <span class="pill">MUST</span></summary><div class="sec"><table class="table"><thead><tr><th>API</th><th>Signature</th><th>Notes</th></tr></thead><tbody><tr><td class="mono">renderManifest</td><td class="mono">(manifest, mountEl) ‚Üí HTMLElement</td><td>MUST clear mount; MUST render deterministic order.</td></tr><tr><td class="mono">applyTokens</td><td class="mono">(tokens, scopeEl?)</td><td>Writes CSS vars; MUST not crash on unknown tokens.</td></tr><tr><td class="mono">bindEvents</td><td class="mono">(events, mountEl, taskRunner)</td><td>Event targets MUST resolve; missing targets MUST no-op deterministically.</td></tr></tbody></table></div></details><details><summary>Mead Reference (Readable) <span class="pill">RI</span></summary><div class="sec"><div class="code"><div class="bar"><div class="lab">Mead.js (reference)</div><button class="btn" data-copy="#mea1">‚ßâ Copy</button></div><pre><code id="mea1">/* Mead.js ‚Äî Load: Manifest ‚Üí Deterministic DOM */\nconst Mead={\n  applyTokens:(tokens,scopeEl)=>{const el=scopeEl||document.documentElement;Object.keys(tokens||{}).sort().forEach(k=>{try{el.style.setProperty(k,String(tokens[k]));}catch(e){}});},\n  renderManifest:(manifest,mountEl)=>{if(!manifest||!mountEl)throw new Error(\"WC6 render requires manifest+mount\");mountEl.textContent=\"\";const byId=new Map();(manifest.blueprints||[]).forEach(b=>byId.set(b.id,b));const build=(id)=>{const b=byId.get(id);if(!b)return document.createComment(\"missing:\"+id);const el=document.createElement(b.tag||\"div\");el.setAttribute(\"data-wc6-id\",b.id);const attrs=b.attrs||{};Object.keys(attrs).sort().forEach(k=>{try{el.setAttribute(k,attrs[k]);}catch(e){}});if(b.text)el.appendChild(document.createTextNode(b.text));(b.children||[]).forEach(cid=>el.appendChild(build(cid)));return el;};const rootId=manifest.rootId||(manifest.blueprints&&manifest.blueprints[0]?manifest.blueprints[0].id:null);const root=build(rootId);mountEl.appendChild(root);return root;},\n  bindEvents:(events,mountEl,taskRunner)=>{(events||[]).forEach(e=>{const t=mountEl.querySelector('[data-wc6-id=\"'+e.targetId+'\"]');if(!t)return;const type=(e.type||\"click\").toLowerCase();t.addEventListener(type,ev=>{try{taskRunner(e.action,ev);}catch(err){}});});}\n};</code></pre></div></div></details></div><div class="card sec" id="polymorphi"><h2><span class="n">¬ß11</span>Polymorphi.css (Tokens)</h2><p>Polymorphi.css is a token library whose values live in CSS custom properties. WC6 treats tokens as the only value substrate: render-time styling MUST resolve through tokens (variables), not hard-coded literals in execution code.</p><details open><summary>Token Rules <span class="pill">Normative</span></summary><div class="sec"><ul><li>Token keys MUST be <span class="mono">--token-####-*</span> style custom properties.</li><li>Tokens MUST be resolvable via CSS variable fallback chain.</li><li>Semantic tokens SHOULD map to sub-primitive tokens, which map to primitive tokens.</li><li>Implementations MAY ship only a subset of token families, but MUST document which ranges exist.</li></ul><div class="hr"></div><table class="table"><thead><tr><th>Layer</th><th>Example</th><th>Meaning</th></tr></thead><tbody><tr><td>Primitive</td><td class="mono">--token-2001-raw-lion</td><td>Atomic literal (base color, base spacing)</td></tr><tr><td>Sub-Primitive</td><td class="mono">--token-2101-accent</td><td>Derived from primitive(s)</td></tr><tr><td>Semantic</td><td class="mono">--token-2301-button-primary-bg</td><td>UI meaning; maps to sub-primitive(s)</td></tr></tbody></table></div></details></div><div class="card sec" id="atomic-controller"><h2><span class="n">¬ß12</span>Atomic Controller</h2><p>The Atomic Controller serializes transforms to prevent tearing invariants. WC6‚Äôs default strategy: one chain per policy domain (scope). Implementations MAY implement finer-grained scope partitioning.</p><details open><summary>Atomic Commit Contract <span class="pill">MUST</span></summary><div class="sec"><ul><li><span class="mono">commit(scope, fn)</span> MUST enqueue <span class="mono">fn</span> behind previous scope work.</li><li>MUST return a Promise resolving to fn‚Äôs result.</li><li>MUST prevent unhandled rejection from poisoning the chain.</li><li>SHOULD avoid unbounded memory growth (chain truncation strategy).</li></ul></div></details></div><div class="card sec" id="scheduling"><h2><span class="n">¬ß13</span>Tasks / Scheduling</h2><p>Scheduling is explicit. A task is addressable and can be bound to events or internal sequences. The schedule defines ordering, scope, and (optionally) priority.</p><details open><summary>Task Spec <span class="pill">MUST</span></summary><div class="sec"><table class="table"><thead><tr><th>Field</th><th>Type</th><th>Rules</th></tr></thead><tbody><tr><td class="mono">id</td><td class="mono">string</td><td>MUST be unique; SHOULD be namespaced</td></tr><tr><td class="mono">scope</td><td class="mono">string</td><td>MUST map to policy domain; used by AtomicController</td></tr><tr><td class="mono">run</td><td class="mono">string|function</td><td>In RI this is string; implementations MAY store function references</td></tr></tbody></table></div></details></div><div class="card sec" id="memorymodel"><h2><span class="n">¬ß14</span>Memory / Determinism</h2><p>WC6 defines determinism as output stability under defined inputs and environmental constraints. Memory model concerns are handled by atomic control and explicit manifests.</p><details open><summary>Determinism Rules <span class="pill">MUST</span></summary><div class="sec"><ul><li>Blueprint ordering MUST be stable for identical inputs.</li><li>Attribute application MUST use stable ordering (sorted keys).</li><li>Event binding MUST occur after render; event targets MUST resolve deterministically.</li><li>Token application MUST be pure assignment of CSS vars; no hard-coded fallback changes in code.</li></ul></div></details></div><div class="card sec" id="security"><h2><span class="n">¬ß15</span>Security / Trust</h2><p>Security is defined by trust boundaries: the executive function controller MUST validate IDs, and the runtime MUST not execute untrusted code by default. This deck‚Äôs RI avoids <span class="mono">eval</span> entirely.</p><details open><summary>Trust Boundaries <span class="pill">MUST</span></summary><div class="sec"><ul><li><b>Input boundary:</b> reject invalid IDs; reject unknown blueprint references.</li><li><b>Task boundary:</b> task execution MUST be explicit; untrusted tasks SHOULD be sandboxed.</li><li><b>Render boundary:</b> only DOM construction; no automatic script injection.</li><li><b>Token boundary:</b> tokens are CSS variables; must not leak secrets.</li></ul></div></details></div><div class="card sec" id="integrity"><h2><span class="n">¬ß16</span>Integrity / Provenance</h2><p>WC6 supports provenance by design: manifests are data objects. Implementations MAY add integrity seals (hashes, signatures). If added, they MUST not alter render determinism.</p></div><div class="card sec" id="mapping"><h2><span class="n">¬ß17</span>Mapping to java.util.concurrent</h2><p>This mapping is conceptual: WC6 does not import Java; it converges on the same concurrency bones in a different substrate (browser runtime vs JVM). The point is auditability: reviewers can align mental models quickly.</p><table class="table"><thead><tr><th>java.util.concurrent</th><th>WC6 Concept</th><th>Bridge Statement</th></tr></thead><tbody><tr><td class="mono">Executor / ExecutorService</td><td>Executor (Nectar) + AtomicController</td><td>Work submission + scoped serialization</td></tr><tr><td class="mono">Future</td><td>Manifest result / Promise</td><td>Result object resolved after atomic commit</td></tr><tr><td class="mono">BlockingQueue</td><td>Scope chain queue</td><td>Work ordering per policy domain</td></tr><tr><td class="mono">Locks / Synchronizers</td><td>ID discipline + atomic commit boundary</td><td>Instead of locking shared memory, serialize mutations by scope</td></tr><tr><td class="mono">Atomics</td><td>Surrogate primitives + deterministic updates</td><td>Subatomic units provide minimal, composable invariants</td></tr></tbody></table></div><div class="card sec" id="ri"><h2><span class="n">¬ß18</span>Reference Implementation (Embedded Demo)</h2><p>This demo is intentionally simple: paste HTML, extract blueprints with Pollen, transform into manifest with Nectar, render with Mead. It demonstrates the contract without dependencies.</p><div class="demo"><div><div class="frame"><div class="ft">Left: Input (HTML)</div><textarea id="htmlIn">&lt;div class=&quot;box&quot; data-wc6-onclick=&quot;task:ping&quot;&gt;Hello WC6&lt;span&gt; ¬∑ subnode&lt;/span&gt;&lt;/div&gt;</textarea><div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap"><button class="btn primary" id="runExtract">1) Pollen Extract</button><button class="btn primary" id="runTransform">2) Nectar Transform</button><button class="btn primary" id="runRender">3) Mead Render</button><button class="btn" id="clearDemo">Clear</button></div></div></div><div><div class="frame"><div class="ft">Right: Output (Manifest + Render)</div><textarea id="outJson" placeholder="Manifest JSON will appear here‚Ä¶"></textarea><div class="hr"></div><div class="frame" id="renderBox" style="min-height:190px"><div class="ft">Rendered DOM (inside this frame)</div><div id="app"></div></div></div></div></div></div><div class="card sec" id="glossary"><h2><span class="n">¬ß19</span>Glossary</h2><table class="table"><thead><tr><th>Term</th><th>Meaning</th></tr></thead><tbody><tr><td class="mono">Executive Function Controller</td><td>Input boundary that validates and routes; rejects invalid IDs.</td></tr><tr><td class="mono">Policy Domain</td><td>Scope key for atomic serialization; a concurrency partition.</td></tr><tr><td class="mono">Blueprint</td><td>Normalized structural representation of renderable nodes.</td></tr><tr><td class="mono">Manifest</td><td>Serializable contract for deterministic rendering.</td></tr><tr><td class="mono">Token</td><td>CSS variable key used for all value resolution.</td></tr><tr><td class="mono">Surrogate</td><td>Subatomic composable unit between primitives and tokens.</td></tr></tbody></table></div><div class="card sec" id="revision"><h2><span class="n">¬ß20</span>Revision / Notes</h2><p class="mono">Deck build: WC6 Manual Deck (single artifact). Print/PDF via browser print engine. No external downloads, no external dependencies, no link-only deliverables.</p><div class="foot">Web Concurrency 6.0 ¬∑ Normalized Web ¬∑ Manual Deck</div></div></div><script>(function(){const U={byId:(id)=>document.getElementById(id),qs:(s)=>document.querySelector(s),qsa:(s)=>Array.from(document.querySelectorAll(s)),now:()=>performance.now(),clamp:(v,a,b)=>Math.max(a,Math.min(b,v))};const WC6={util:{id:()=>Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2),copy:(t)=>navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t):Promise.reject(new Error("Clipboard unavailable")),stableKeys:(o)=>Object.keys(o||{}).sort()}};const Registry=(function(){const ns=new Map();const getNS=(n)=>{if(!ns.has(n))ns.set(n,new Map());return ns.get(n);};return{put:(n,k,v)=>{getNS(n).set(k,v);return v;},get:(n,k)=>getNS(n).get(k)};})();const AtomicController=(function(){const chains=new Map();const get=(s)=>{if(!chains.has(s))chains.set(s,Promise.resolve());return chains.get(s);};return{commit:(s,f)=>{const p=get(s);const n=p.then(()=>Promise.resolve().then(f));chains.set(s,n.catch(()=>{}));return n;}};})();const Pollen={extractDOM:(rootEl,opts={})=>{const idKey=opts.idKey||"data-wc6-id";let c=0;const mk=()=>("node-"+(++c));const blue=[];const walk=(el)=>{if(!el||el.nodeType!==1)return null;const id=el.getAttribute(idKey)||mk();el.setAttribute(idKey,id);const attrs={};Array.from(el.attributes||[]).forEach(a=>{if(a&&a.name)attrs[a.name]=a.value;});const kids=[];Array.from(el.childNodes||[]).forEach(n=>{if(n.nodeType===1){const kid=walk(n);if(kid)kids.push(kid);}});const text=Array.from(el.childNodes||[]).filter(n=>n.nodeType===3).map(n=>n.nodeValue).join("").trim();blue.push({id,tag:(el.tagName||"div").toLowerCase(),attrs,text,children:kids});return id;};const rootId=walk(rootEl);return{rootId,blueprints:blue};},extractEvents:(rootEl)=>{const intents=[];const all=[rootEl,...Array.from(rootEl.querySelectorAll("*")||[])];all.forEach(el=>{Array.from(el.attributes||[]).forEach(a=>{if(!a||!a.name)return;const n=a.name.toLowerCase();if(n.startsWith("data-wc6-on")){const type=n.replace("data-wc6-on","")||"click";const targetId=el.getAttribute("data-wc6-id")||"";const action=a.value||"";intents.push({targetId,type,action});}});});return intents;}};const Nectar={validate:(bps)=>{const set=new Set();for(const b of (bps||[])){if(!b||typeof b.id!=="string"||!b.id.trim())throw new Error("WC6 ID invalid");if(set.has(b.id))throw new Error("WC6 duplicate ID: "+b.id);set.add(b.id);(b.children||[]).forEach(cid=>{if(typeof cid!=="string")throw new Error("WC6 child ref invalid");});}return true;},sovereign:(pollen,opts={})=>{const scope=opts.policyDomain||"default";return AtomicController.commit(scope,()=>{if(!pollen||!pollen.blueprints||!pollen.rootId)throw new Error("WC6 sovereign requires pollen output");Nectar.validate(pollen.blueprints);const m={manifestId:"wc6-"+WC6.util.id(),version:"6.0.0",policyDomain:scope,createdAt:new Date().toISOString(),rootId:pollen.rootId,blueprints:pollen.blueprints,tokens:opts.tokens||{},events:opts.events||[],tasks:opts.tasks||[],extensions:opts.extensions||{}};Registry.put("manifests","last",m);return m;});}};const Mead={applyTokens:(t,scopeEl)=>{const el=scopeEl||document.documentElement;WC6.util.stableKeys(t||{}).forEach(k=>{try{el.style.setProperty(k,String(t[k]));}catch(e){}});},render:(m,mount)=>{if(!m||!mount)throw new Error("WC6 render requires manifest+mount");mount.textContent="";const byId=new Map();(m.blueprints||[]).forEach(b=>byId.set(b.id,b));const build=(id)=>{const b=byId.get(id);if(!b)return document.createComment("missing:"+id);const el=document.createElement(b.tag||"div");el.setAttribute("data-wc6-id",b.id);const attrs=b.attrs||{};WC6.util.stableKeys(attrs).forEach(k=>{try{el.setAttribute(k,attrs[k]);}catch(e){}});if(b.text)el.appendChild(document.createTextNode(b.text));(b.children||[]).forEach(cid=>el.appendChild(build(cid)));return el;};const root=build(m.rootId||(m.blueprints&&m.blueprints[0]?m.blueprints[0].id:null));mount.appendChild(root);return root;},bind:(evs,mount,runner)=>{(evs||[]).forEach(e=>{const t=mount.querySelector('[data-wc6-id="'+e.targetId+'"]');if(!t)return;t.addEventListener((e.type||"click").toLowerCase(),ev=>{try{runner(e.action,ev);}catch(err){}});});}};const taskRunner=(action)=>{const out=U.byId("outJson");out.value=(out.value||"")+("\n[task] "+String(action||""));};const ScrollFx=(function(){let anim=null;let lastShow=0;const sd=U.byId("sd"),sdTrack=U.byId("sdTrack"),sdPos=U.byId("sdPos");let sections=[];let current=-1;const ease=(t)=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;const topPad=()=>{const tb=U.qs(".topbar");return (tb?tb.getBoundingClientRect().height:0)+16;};const buildSections=()=>{const cards=U.qsa(".card[id]");sections=cards.map(el=>{const id=el.id;let label=id;const h2=el.querySelector("h2");const title=el.querySelector(".title");if(title)label=title.textContent.trim();else if(h2)label=h2.textContent.replace(/\s+/g," ").trim();else label=id;return{id,label,el};}).filter(x=>x.id);};const sectionTop=(s)=>{const y=s.el.getBoundingClientRect().top+window.scrollY;return Math.max(0,Math.floor(y-topPad()));};const findIndex=(y)=>{let idx=0;for(let i=0;i<sections.length;i++){if(sectionTop(sections[i])<=y+6)idx=i;}return idx;};const showSd=(force)=>{const now=U.now();if(force||now-lastShow>60){sd.classList.add("on");lastShow=now;}};const hideSdLater=()=>{const stamp=U.now();setTimeout(()=>{if(U.now()-stamp>720&&(!anim))sd.classList.remove("on");},740);};const renderSd=(idx,pulse)=>{if(!sections.length)return;idx=U.clamp(idx,0,sections.length-1);current=idx;sdPos.textContent=(idx+1)+"/"+sections.length;const windowSize=7;const mid=Math.floor(windowSize/2);const items=[];for(let k=0;k<windowSize;k++){const at=idx+(k-mid);const s=sections[U.clamp(at,0,sections.length-1)];const isA=(at===idx);items.push({txt:s.label,act:isA});}sdTrack.innerHTML=items.map(it=>'<div class="item'+(it.act?' active':'')+'"><span class="dot"></span><span>'+escapeHtml(it.txt)+'</span></div>').join("");const itemH=28;const base=(windowSize*itemH)/2;sdTrack.style.transform="translateY(calc(-50% + "+((mid*itemH)-(base-itemH/2))+"px))";if(pulse){sd.classList.remove("pulse");void sd.offsetWidth;sd.classList.add("pulse");}};const escapeHtml=(s)=>String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");const cancel=()=>{if(anim){anim.cancelled=true;anim=null;}};const scrollToY=(targetY,dur)=>{cancel();showSd(true);const startY=window.scrollY;const delta=targetY-startY;const startT=U.now();anim={cancelled:false};const step=()=>{if(!anim||anim.cancelled)return;const t=U.clamp((U.now()-startT)/dur,0,1);const y=Math.round(startY+delta*ease(t));window.scrollTo(0,y);renderSd(findIndex(y),false);if(t<1){requestAnimationFrame(step);}else{const idx=findIndex(targetY);renderSd(idx,true);anim=null;hideSdLater();}};requestAnimationFrame(step);};const scrolodexTo=(id)=>{const s=sections.find(x=>x.id===id);if(!s)return;const y=sectionTop(s);const dist=Math.abs(window.scrollY-y);const dur=U.clamp(260+dist*0.35,380,1100);scrollToY(y,dur);};const onScroll=()=>{if(anim)return;const y=window.scrollY;const idx=findIndex(y);if(idx!==current){showSd(false);renderSd(idx,false);}else{showSd(false);}hideSdLater();};return{init:()=>{buildSections();renderSd(findIndex(window.scrollY),false);window.addEventListener("scroll",onScroll,{passive:true});},rebuild:()=>{buildSections();renderSd(findIndex(window.scrollY),false);},to:scrolodexTo,cancel};})();const highlightNav=()=>{const ids=U.qsa(".card[id]").map(el=>el.id);let best="cover",bestTop=Infinity;ids.forEach(id=>{const el=U.byId(id);if(!el)return;const r=el.getBoundingClientRect();const dist=Math.abs(r.top-90);if(r.top<160&&dist<bestTop){bestTop=dist;best=id;}});U.qsa(".nav a").forEach(a=>a.classList.toggle("active",(a.getAttribute("href")||"")==="#"+best));};const filterSections=(term)=>{const q=(term||"").trim().toLowerCase();const cards=U.qsa(".card");if(!q){cards.forEach(c=>c.classList.remove("hide"));ScrollFx.rebuild();return;}cards.forEach(c=>{const t=(c.textContent||"").toLowerCase();c.classList.toggle("hide",!t.includes(q));});ScrollFx.rebuild();};const collapseAll=()=>{U.qsa("details").forEach(d=>d.open=false);};const copyDeck=()=>{WC6.util.copy(document.documentElement.outerHTML).catch(()=>{});};const bindCopyButtons=()=>{U.qsa("[data-copy]").forEach(btn=>{btn.addEventListener("click",()=>{const sel=btn.getAttribute("data-copy");const el=sel?U.qs(sel):null;WC6.util.copy(el?el.textContent:"").catch(()=>{});});});};const runDemo=(()=>{let pollen=null,manifest=null;const parseHTML=(html)=>{const d=document.implementation.createHTMLDocument("wc6");d.body.innerHTML=html;return d;};return{extract:()=>{const html=U.byId("htmlIn").value||"";const d=parseHTML(html);pollen=Pollen.extractDOM(d.body,{idKey:"data-wc6-id"});const events=Pollen.extractEvents(d.body);Registry.put("pollen","last",pollen);Registry.put("pollen","events",events);U.byId("outJson").value=JSON.stringify({pollen,events},null,2);return pollen;},transform:()=>{if(!pollen)throw new Error("Run extract first");const events=Registry.get("pollen","events")||[];return Nectar.sovereign(pollen,{policyDomain:"default",tokens:{"--token-2301-button-primary-bg":"var(--lion)","--token-2302-button-primary-fg":"var(--white)"},events,tasks:[{id:"task:ping",scope:"default",run:"append log"}],extensions:{deck:true}}).then(m=>{manifest=m;Registry.put("manifests","last",m);U.byId("outJson").value=JSON.stringify(m,null,2);return m;});},render:()=>{if(!manifest)throw new Error("Run transform first");Mead.applyTokens(manifest.tokens,document.documentElement);const mount=U.byId("app");const root=Mead.render(manifest,mount);Mead.bind(manifest.events,mount,taskRunner);U.byId("outJson").value=(U.byId("outJson").value||"")+("\n\n[rendered] root="+root.getAttribute("data-wc6-id"));return root;},clear:()=>{pollen=null;manifest=null;U.byId("outJson").value="";U.byId("app").textContent="";}};})();const bindNavScrolodex=()=>{U.qsa(".nav a[href^='#']").forEach(a=>{a.addEventListener("click",(ev)=>{ev.preventDefault();const id=(a.getAttribute("href")||"").replace("#","");if(!id)return;U.byId("side").classList.remove("open");ScrollFx.to(id);});});};document.addEventListener("DOMContentLoaded",()=>{bindCopyButtons();bindNavScrolodex();ScrollFx.init();U.byId("btnTop").addEventListener("click",()=>ScrollFx.to("cover"));U.byId("btnPrint").addEventListener("click",()=>window.print());U.byId("btnCopy").addEventListener("click",copyDeck);U.byId("btnCollapse").addEventListener("click",collapseAll);U.byId("btnSide").addEventListener("click",()=>U.byId("side").classList.toggle("open"));U.byId("q").addEventListener("input",(e)=>filterSections(e.target.value));window.addEventListener("scroll",highlightNav,{passive:true});highlightNav();U.byId("runExtract").addEventListener("click",()=>{try{runDemo.extract();}catch(e){}});U.byId("runTransform").addEventListener("click",()=>{runDemo.transform().catch(()=>{});});U.byId("runRender").addEventListener("click",()=>{try{runDemo.render();}catch(e){}});U.byId("clearDemo").addEventListener("click",()=>{runDemo.clear();});});})();</script></main></div></body></html>